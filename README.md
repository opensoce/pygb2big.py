# pygb2big.py
submit the pygb2big.py file

---------------
GB码与BIG5是中国人常用的两种编码集。GB码为大陆使用，BIG5为香港与台湾使用
。每个编码都由2个字符构成，高字节在前，低字节在后。下面我将使用Python实
现的编码转换的程序向大家作一个介绍。关于编码的一些知识大家可以去网上查找
，本人不再赘述。 GB码是大陆使用的编码集。以前使用的为GB-2312编程，它只有
常用字，字数有限。后国家制定了新的GBK编码，汉字已经达到了2万多。GBK完全
兼容原GB-2312编码，也就是说一个GB2312的编码在GBK上是一模一样的。这里所介
绍的转换是以GBK为基础的，因此适用性很广。GBK编码中不仅包括了原GB-2312编
码，同时也包括了许多简码的繁体码，同时还有许多的符号与不常用汉字。GBK编
码的范围是：高字节从0x81到0xFE，低字节从0x40到0xFE，同时不包括0x7F。这样
如果我们将其排成一个矩形，看上去就少了xx7F一根线。  
  
编码的定位  
那么如何定位一个GBK码呢？当我们拿到一个编码时，如何判断是不是一个GBK码，
如果是GBK码如何定位它的位置呢？  
  
判断一个GBK码应该比较简单，我们只要根据它的有效范围进行判定即可。如:  
  
if 0x81<=ch1<=0xFE and (0x40<=ch2<=0x7E or 0x7E<=ch2<=0xFE): #is gb char
  
  
  
这里ch1和ch2分别是一个字符的高字节和低字节。  
  
如何定位（为什么要定位我们在后面讲）？首先介绍一下码表。码表是所有编码放
在一起形成的，你可以将其放在文件中（这里讲述的是将编码放在文件中）。我们
在存放编码时是将有实际意义的编码放在了一起（因为有一些组合是不存在的），
而且是按字节大小的顺序放的。根据GBK的编码范围，我们可以设想一个二维坐标
，纵坐标是高字节，横坐标是低字节，每一个交叉点上是一个汉字，占两个字节。
这样一行上的汉字个数应该为0xFE-0x40+1-1=190（加1是因为要把0x40也算进去。
减1是因为要把7F去掉）。定位时，我们先用高字节减去0x81，得到纵坐标偏移量
。用低字节减去0x40得到横坐标偏移量。用纵坐标偏移量乘以每个汉字个数，加上
横坐标偏移量就得到汉字的偏移量。再乘以2得到字节的偏移量。那么定位算法为:
  
  
index=((ch1-0x81)*190+(ch2-0x40)-(ch2/128))*2  
  
  
上面的算法中有-(ch2/128)。这是因为GBK中没有7F码，因此当ch2小于7F时，
ch2/128=0，则表示7F没有计算在内。而当ch2大于7F时，ch2/128=1，则表示多算
了7F一值，因此要去掉。由于一个汉字有两个字节，故要乘以2。这样我们就得到
一个GBK汉字在码表中的字节位置了。  
  
BIG5是香港和台湾地区使用的编码集。它的范围为：高字节从0xA0到0xFE，低字节
从0x40到0x7E，和0xA1到0xFE两部分。判断一个汉字是否是BIG5编码，可以如上对
字符的编码范围判断即可。如何定位呢？那么也想象所有编码排列为一个二维坐标
，纵坐标是高字节，横坐标是低字节。这样一行上的汉字个数：
(0x7E-0x40+1)+(0xFE-0xA1+1)＝157。那么定位算法分两块，为:  
  
if 0x40<=ch2<=0x7E: #is big5 char  
index=((ch1-0xA1)*157+(ch2-0x40))*2  
elif 0xA1<=ch2<=0xFE: #is big5 char  
index=((ch1-0xA1)*157+(ch2-0xA1+63))*2  
  
  
对于第二块，计算偏移量时因为有两块数值，所以在计算后面一段值时，不要忘了
前面还有一段值。0x7E-0x40+1=63。  
  
编码转换  
上面，我们已经可以得到GBK汉字和BIG5的字节位置。那么就可以开始进行转换了
。对于转换我原以为有一个特别的算法，能够按照两种编码的不同，简单地通过计
算就可以得出结果来，其实是不存在这种算法的。真正的做法是通过建立转换码表
文件实现的。即对于GBK码表，将原位置上的GBK汉字改成相应的BIG5汉字。对于
BIG5码表，将原位置上的BIG5汉字改成相应的GBK汉字。这样，由于原来汉字的位
置没有变，但编码已经变成了想要转换的编码。通过计算出原汉字的位置，将转换
码表中对应汉字位置的字符取出来，这样就完成了转换（这就是为什么要进行编码
定位的原因）。的确，程序是简单的，但真正细致的工作是在建立转换码表上。我
们需要从GBK转BIG5的码表文件，和BIG5转GBK的码表文件。好在这一工作已经有人
完成了，在网上可以找到这种信息。本人就是在网上找到了这种对应的转换码表，
于是完成了一个用Python做的编码转换程序。（想要此程序的可以去作者主页
http://pyrecord.126.com上查找）  
  
一个用于编码转换的Python模块的使用介绍  
程序文件名为pygb2big.py。命令行:  
  
python pygb2big.py [-u] [-b|-g] inputfile outputfile。  
  
  
它主要的命令行参数为：-b，表示将GBK转化为BIG5；-g，表示将BIG5转成GBK；
-u，显示程序的用法。inputfile为输入的待处理的文件；而ouputfile为结果文件
。它带有三个转换码表文件，其中gbk2big.txt为GBK转big5对照表；big2gbk.txt
为BIG转GBKcf对照表。另一个为big2gbk-f.txt，只是提供但并未使用，它是将
BIG5转换为繁体GBK码。  
  
有了这个转换模块，我们就可以应用于任何需要进行码制转换的地方了。当然，这
里只是GBK到BIG5的转换，如果有其它的转换码表文件，我们也可以实现其它的转
换功能。
